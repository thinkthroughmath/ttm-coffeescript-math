<!DOCTYPE html>

<html>
<head>
  <title>expression_components.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="build_expression_from_javascript_object_spec.html">
                build_expression_from_javascript_object_spec.coffee
              </a>
            
              
              <a class="source" href="expression_components_spec.html">
                expression_components_spec.coffee
              </a>
            
              
              <a class="source" href="expression_equality_spec.html">
                expression_equality_spec.coffee
              </a>
            
              
              <a class="source" href="expression_evaluation_spec.html">
                expression_evaluation_spec.coffee
              </a>
            
              
              <a class="source" href="expression_manipulation_spec.html">
                expression_manipulation_spec.coffee
              </a>
            
              
              <a class="source" href="expression_position_spec.html">
                expression_position_spec.coffee
              </a>
            
              
              <a class="source" href="expression_to_string_spec.html">
                expression_to_string_spec.coffee
              </a>
            
              
              <a class="source" href="expression_traversal_spec.html">
                expression_traversal_spec.coffee
              </a>
            
              
              <a class="source" href="precise_spec.html">
                precise_spec.coffee
              </a>
            
              
              <a class="source" href="regression_spec.html">
                regression_spec.coffee
              </a>
            
              
              <a class="source" href="spec_helpers.html">
                spec_helpers.coffee
              </a>
            
              
              <a class="source" href="browser.html">
                browser.coffee
              </a>
            
              
              <a class="source" href="math.html">
                math.coffee
              </a>
            
              
              <a class="source" href="build_expression_from_javascript_object.html">
                build_expression_from_javascript_object.coffee
              </a>
            
              
              <a class="source" href="expression_components.html">
                expression_components.coffee
              </a>
            
              
              <a class="source" href="expression_equality.html">
                expression_equality.coffee
              </a>
            
              
              <a class="source" href="expression_evaluation.html">
                expression_evaluation.coffee
              </a>
            
              
              <a class="source" href="expression_manipulation.html">
                expression_manipulation.coffee
              </a>
            
              
              <a class="source" href="expression_position.html">
                expression_position.coffee
              </a>
            
              
              <a class="source" href="expression_to_string.html">
                expression_to_string.coffee
              </a>
            
              
              <a class="source" href="expression_traversal.html">
                expression_traversal.coffee
              </a>
            
              
              <a class="source" href="precise.html">
                precise.coffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>expression_components.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>ttm = thinkthroughmath

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExpressionComponent</span></span>
  <span class="hljs-attribute">initialize</span>: <span class="hljs-function"><span class="hljs-params">(opts={})</span>-&gt;</span>
    <span class="hljs-property">@component_source</span> = opts.component_source
    <span class="hljs-property">@id_value</span> = opts.id
    <span class="hljs-property">@parent_value</span> = opts.parent

  <span class="hljs-attribute">isNumber</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-literal">false</span>
  <span class="hljs-attribute">isExpression</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-literal">false</span>
  <span class="hljs-attribute">isMultiplication</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-literal">false</span>
  <span class="hljs-attribute">isFraction</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-literal">false</span>
  <span class="hljs-attribute">isVariable</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-literal">false</span>
  <span class="hljs-attribute">isExponentiation</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-literal">false</span>
  <span class="hljs-attribute">isRoot</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-literal">false</span>

  <span class="hljs-attribute">preceedingSubexpression</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-literal">false</span>
  <span class="hljs-attribute">cloneData</span>: <span class="hljs-function"><span class="hljs-params">(opts)</span>=&gt;</span> ttm.defaults(opts, {<span class="hljs-attribute">id</span>: <span class="hljs-property">@id_value</span>, <span class="hljs-attribute">parent</span>: <span class="hljs-property">@parent_value</span>})
  <span class="hljs-attribute">clone</span>: <span class="hljs-function"><span class="hljs-params">(opts={})</span>-&gt;</span> <span class="hljs-property">@klass</span>.build(<span class="hljs-property">@cloneData</span>(opts))
  <span class="hljs-attribute">id</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-property">@id_value</span>
  <span class="hljs-attribute">subExpressions</span>:<span class="hljs-function"> -&gt;</span> []
  <span class="hljs-attribute">parent</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-property">@parent_value</span>
  <span class="hljs-attribute">withParent</span>: <span class="hljs-function"><span class="hljs-params">(parent)</span>-&gt;</span>
    ret = <span class="hljs-property">@clone</span>(<span class="hljs-attribute">parent</span>: parent)</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>@destructive</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">replaceImmediateSubComponentD</span>: <span class="hljs-function"><span class="hljs-params">(field, old_comp, new_comp)</span>-&gt;</span>
    <span class="hljs-keyword">for</span> comp, index <span class="hljs-keyword">in</span> @[field]
      <span class="hljs-keyword">if</span> comp.id() == old_comp.id()
        new_comp = new_comp.withParent(@)
        @[field][index] = new_comp
    <span class="hljs-literal">null</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Equals</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ExpressionComponent</span></span>
  <span class="hljs-attribute">toString</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-string">"="</span>
ttm.class_mixer(Equals)


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Expression</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ExpressionComponent</span></span>
  <span class="hljs-property">@buildWithContent</span>: <span class="hljs-function"><span class="hljs-params">(content)</span>-&gt;</span>
    <span class="hljs-property">@build</span>(<span class="hljs-attribute">expression</span>: content)

  <span class="hljs-property">@buildError</span>: <span class="hljs-function"><span class="hljs-params">(content)</span>-&gt;</span>
    <span class="hljs-property">@build</span>(<span class="hljs-attribute">is_error</span>: <span class="hljs-literal">true</span>)

  <span class="hljs-property">@buildUnlessExpression</span>: <span class="hljs-function"><span class="hljs-params">(content)</span>-&gt;</span>
    <span class="hljs-keyword">if</span> content <span class="hljs-keyword">instanceof</span> <span class="hljs-property">@comps</span>.classes.expression
      content
    <span class="hljs-keyword">else</span>
      <span class="hljs-property">@buildWithContent</span>([content])

  <span class="hljs-attribute">initialize</span>: <span class="hljs-function"><span class="hljs-params">(opts={})</span>-&gt;</span>
    <span class="hljs-keyword">super</span>
    defaults =
      <span class="hljs-attribute">expression</span>: []
      <span class="hljs-attribute">is_error</span>: <span class="hljs-literal">false</span>
    opts = _.extend({}, defaults, opts)

    <span class="hljs-property">@expression</span> = []
    <span class="hljs-keyword">for</span> part <span class="hljs-keyword">in</span> opts.expression
      <span class="hljs-property">@expression</span>.push(part.withParent(@))

    <span class="hljs-property">@is_error</span> = opts.is_error

  <span class="hljs-attribute">cloneData</span>: <span class="hljs-function"><span class="hljs-params">(new_vals={})</span>-&gt;</span>
    ttm.defaults(<span class="hljs-keyword">super</span>,
    {
      <span class="hljs-attribute">expression</span>: _.map<span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@expression</span>, (it)-&gt; it.clone())</span>
      <span class="hljs-title">is_error</span>: @<span class="hljs-title">is_error</span>
      <span class="hljs-title">id</span>: @<span class="hljs-title">id_value</span>
    })

</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>returns part of an expression</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">last</span>: <span class="hljs-function"><span class="hljs-params">(from_end=<span class="hljs-number">0</span>)</span>-&gt;</span>
    <span class="hljs-property">@expression</span>[<span class="hljs-property">@expression</span>.length - <span class="hljs-number">1</span> - from_end]

  <span class="hljs-attribute">first</span>:<span class="hljs-function"> -&gt;</span>
    _.first(<span class="hljs-property">@expression</span>)

  <span class="hljs-attribute">nth</span>: <span class="hljs-function"><span class="hljs-params">(n)</span>-&gt;</span>
    <span class="hljs-property">@expression</span>[n]

  <span class="hljs-attribute">reset</span>:<span class="hljs-function"> -&gt;</span>
    <span class="hljs-property">@expression</span> = []

  <span class="hljs-attribute">size</span>:<span class="hljs-function"> -&gt;</span>
    _(<span class="hljs-property">@expression</span>).size();

  <span class="hljs-attribute">isBlank</span>:<span class="hljs-function"> -&gt;</span>
    <span class="hljs-property">@size</span>() == <span class="hljs-number">0</span>

  <span class="hljs-attribute">isEmpty</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-property">@isBlank</span>()

  <span class="hljs-attribute">set</span>: <span class="hljs-function"><span class="hljs-params">(expression)</span>-&gt;</span>
    <span class="hljs-property">@expression</span> = expression

  <span class="hljs-attribute">append</span>: <span class="hljs-function"><span class="hljs-params">(new_last)</span>-&gt;</span>
    expr = _.clone(<span class="hljs-property">@expression</span>)
    expr.push new_last.withParent(@)
    <span class="hljs-property">@clone</span>(<span class="hljs-attribute">expression</span>: expr)</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>@destructive</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">appendD</span>: <span class="hljs-function"><span class="hljs-params">(new_last)</span>-&gt;</span>
    <span class="hljs-property">@expression</span>.push new_last.withParent(@)</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>replace old comp with new comp if it is contained
immediately within this expression</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">replaceD</span>: <span class="hljs-function"><span class="hljs-params">(old_comp, new_comp)</span>-&gt;</span>
    <span class="hljs-property">@replaceImmediateSubComponentD</span>(<span class="hljs-string">"expression"</span>, old_comp, new_comp)

  <span class="hljs-attribute">replaceLast</span>: <span class="hljs-function"><span class="hljs-params">(new_last)</span>-&gt;</span>
    <span class="hljs-property">@withoutLast</span>().append(new_last.withParent(@))</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>@destructive</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">replaceLastD</span>: <span class="hljs-function"><span class="hljs-params">(new_last)</span>-&gt;</span>
    <span class="hljs-property">@expression</span>[<span class="hljs-property">@expression</span>.length-<span class="hljs-number">1</span>] = new_last.withParent(@)

  <span class="hljs-attribute">withoutLast</span>:<span class="hljs-function"> -&gt;</span>
    expr = _.clone(<span class="hljs-property">@expression</span>)
    expr = expr.slice(<span class="hljs-number">0</span>, expr.length-<span class="hljs-number">1</span>)
    <span class="hljs-property">@clone</span>(<span class="hljs-attribute">expression</span>: expr)</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>@destructive</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">withoutLastD</span>:<span class="hljs-function"> -&gt;</span>
    <span class="hljs-property">@expression</span>.splice(<span class="hljs-property">@expression</span>.length-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)

  <span class="hljs-attribute">isError</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-property">@is_error</span>
  <span class="hljs-attribute">isExpression</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-literal">true</span>

  <span class="hljs-attribute">toString</span>:<span class="hljs-function"> -&gt;</span>
    <span class="hljs-function"><span class="hljs-title">tf</span> = <span class="hljs-params">(it)</span>-&gt;</span> it ? <span class="hljs-string">"t"</span> : <span class="hljs-string">"f"</span>
    subexpressions = _<span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@expression</span>)</span>.<span class="hljs-title">chain</span><span class="hljs-params">()</span>.<span class="hljs-title">map</span><span class="hljs-params">((it)-&gt;
      it.toString())</span>.<span class="hljs-title">join</span><span class="hljs-params">(<span class="hljs-string">", "</span>)</span>.<span class="hljs-title">value</span><span class="hljs-params">()</span>
    "<span class="hljs-title">Expression</span><span class="hljs-params">(e: #{tf <span class="hljs-property">@is_error</span>}, exp: [#{subexpressions}])</span>"

  <span class="hljs-title">subExpressions</span>: -&gt;</span> <span class="hljs-property">@expression</span>

ttm.class_mixer(Expression)


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Number</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ExpressionComponent</span></span>
  <span class="hljs-attribute">initialize</span>: <span class="hljs-function"><span class="hljs-params">(opts)</span>-&gt;</span>
    <span class="hljs-keyword">super</span>
    <span class="hljs-property">@precise</span> = opts.precise_lib
    <span class="hljs-property">@val</span> = <span class="hljs-property">@normalizeValue</span>(opts.value)
    <span class="hljs-property">@future_as_decimal</span> = opts.future_as_decimal

  <span class="hljs-attribute">toString</span>:<span class="hljs-function"> -&gt;</span>
    <span class="hljs-string">"#<span class="hljs-subst">#{<span class="hljs-property">@val</span>}</span>"</span>

  <span class="hljs-attribute">isNumber</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-literal">true</span>

  <span class="hljs-attribute">negated</span>:<span class="hljs-function"> -&gt;</span>
    value = <span class="hljs-property">@val</span> * -<span class="hljs-number">1</span>
    Number.build(<span class="hljs-attribute">value</span>: value)</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>@destructive</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">negatedD</span>:<span class="hljs-function"> -&gt;</span>
    <span class="hljs-property">@val</span> *= -<span class="hljs-number">1</span>

  <span class="hljs-attribute">toCalculable</span>:<span class="hljs-function"> -&gt;</span>
    parseFloat(<span class="hljs-property">@val</span>)

  <span class="hljs-attribute">cloneData</span>: <span class="hljs-function"><span class="hljs-params">(opts={})</span>-&gt;</span>
    ttm.defaults(<span class="hljs-keyword">super</span>,
      {
        <span class="hljs-attribute">value</span>: <span class="hljs-property">@val</span>
        <span class="hljs-attribute">future_as_decimal</span>: <span class="hljs-property">@future_as_decimal</span>
      })

  <span class="hljs-attribute">toDisplay</span>:<span class="hljs-function"> -&gt;</span>
    <span class="hljs-keyword">if</span> <span class="hljs-property">@hasDecimal</span>()
      <span class="hljs-property">@valueAtPrecision</span>()
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">if</span> <span class="hljs-property">@future_as_decimal</span>
        <span class="hljs-string">"<span class="hljs-subst">#{<span class="hljs-property">@val</span>}</span>."</span>
      <span class="hljs-keyword">else</span>
        <span class="hljs-string">"<span class="hljs-subst">#{<span class="hljs-property">@val</span>}</span>"</span>

  <span class="hljs-attribute">valueAtPrecision</span>:<span class="hljs-function"> -&gt;</span>
    number_decimal_places = <span class="hljs-number">4</span>
    parts = <span class="hljs-string">"<span class="hljs-subst">#{<span class="hljs-property">@val</span>}</span>"</span>.split(<span class="hljs-string">"."</span>)
    <span class="hljs-keyword">if</span> parts[<span class="hljs-number">1</span>].length &gt; number_decimal_places
      <span class="hljs-string">"<span class="hljs-subst">#{((<span class="hljs-property">@val</span>*<span class="hljs-number">1</span>).toFixed(number_decimal_places) * <span class="hljs-number">1</span>)}</span>"</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-string">"<span class="hljs-subst">#{<span class="hljs-property">@val</span>}</span>"</span>

  <span class="hljs-attribute">value</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-property">@val</span>

  <span class="hljs-attribute">concatenate</span>: <span class="hljs-function"><span class="hljs-params">(number)</span>-&gt;</span>
    new_val =
      <span class="hljs-keyword">if</span> <span class="hljs-property">@future_as_decimal</span>
        <span class="hljs-string">"<span class="hljs-subst">#{<span class="hljs-property">@val</span>}</span>.<span class="hljs-subst">#{number}</span>"</span>
      <span class="hljs-keyword">else</span>
        <span class="hljs-string">"<span class="hljs-subst">#{<span class="hljs-property">@val</span>}</span><span class="hljs-subst">#{number}</span>"</span>
    Number.build(<span class="hljs-attribute">value</span>: new_val)</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>@destructive</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">concatenateD</span>: <span class="hljs-function"><span class="hljs-params">(number)</span>-&gt;</span>
    <span class="hljs-keyword">if</span> <span class="hljs-property">@future_as_decimal</span>
      <span class="hljs-property">@val</span> = <span class="hljs-string">"<span class="hljs-subst">#{<span class="hljs-property">@val</span>}</span>.<span class="hljs-subst">#{number}</span>"</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-property">@val</span> = <span class="hljs-string">"<span class="hljs-subst">#{<span class="hljs-property">@val</span>}</span><span class="hljs-subst">#{number}</span>"</span>
    <span class="hljs-property">@future_as_decimal</span> = <span class="hljs-literal">false</span>

  <span class="hljs-attribute">futureAsDecimal</span>:<span class="hljs-function"> -&gt;</span>
    future_as_decimal = !<span class="hljs-property">@hasDecimal</span>()
    <span class="hljs-property">@clone</span>(<span class="hljs-attribute">future_as_decimal</span>: future_as_decimal)</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>@destructive</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">futureAsDecimalD</span>: <span class="hljs-function"><span class="hljs-params">(value)</span>-&gt;</span>
    <span class="hljs-property">@future_as_decimal</span> = value

  <span class="hljs-attribute">hasDecimal</span>:<span class="hljs-function"> -&gt;</span>
    <span class="hljs-regexp">/\./</span>.test(<span class="hljs-property">@val</span>)

  <span class="hljs-attribute">normalizeValue</span>: <span class="hljs-function"><span class="hljs-params">(val)</span>-&gt;</span>
    val = <span class="hljs-string">"<span class="hljs-subst">#{val}</span>"</span>
    <span class="hljs-keyword">if</span> val.search(<span class="hljs-regexp">/\/</span>/) != -<span class="hljs-number">1</span>
      [num, denom] = val.split(<span class="hljs-string">"/"</span>)
      val = <span class="hljs-property">@precise</span>.div(num, denom)
    val


ttm.class_mixer(Number)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Exponentiation</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ExpressionComponent</span></span>
  <span class="hljs-attribute">initialize</span>: <span class="hljs-function"><span class="hljs-params">(opts={})</span>-&gt;</span>
    <span class="hljs-keyword">super</span>
    <span class="hljs-property">@baseval</span> = opts.base.clone(<span class="hljs-attribute">parent</span>: @)
    <span class="hljs-property">@powerval</span> = opts.power.clone(<span class="hljs-attribute">parent</span>: @)
  <span class="hljs-attribute">base</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-property">@baseval</span>
  <span class="hljs-attribute">power</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-property">@powerval</span>

  <span class="hljs-attribute">preceedingSubexpression</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-property">@base</span>()

  <span class="hljs-attribute">isExponentiation</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-literal">true</span>

  <span class="hljs-attribute">updatePower</span>: <span class="hljs-function"><span class="hljs-params">(power)</span>-&gt;</span>
    <span class="hljs-property">@klass</span>.build <span class="hljs-attribute">base</span>: <span class="hljs-property">@base</span>(), <span class="hljs-attribute">power</span>: power

  <span class="hljs-attribute">toString</span>:<span class="hljs-function"> -&gt;</span>
    <span class="hljs-string">"^(b: <span class="hljs-subst">#{<span class="hljs-property">@base</span>().toString()}</span>, p: <span class="hljs-subst">#{<span class="hljs-property">@power</span>().toString()}</span>)"</span>

  <span class="hljs-attribute">subExpressions</span>:<span class="hljs-function"> -&gt;</span>
    [<span class="hljs-property">@base</span>(), <span class="hljs-property">@power</span>()]

  <span class="hljs-attribute">clone</span>: <span class="hljs-function"><span class="hljs-params">(new_vals={})</span>-&gt;</span>
    data =
      <span class="hljs-attribute">base</span>: <span class="hljs-property">@base</span>().clone()
      <span class="hljs-attribute">power</span>: <span class="hljs-property">@power</span>().clone()
      <span class="hljs-attribute">id</span>: <span class="hljs-property">@id_value</span>
    base_data = <span class="hljs-property">@cloneData</span>()
    other = <span class="hljs-property">@klass</span>.build(_.extend({}, base_data, data, new_vals))
    other</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>replace old comp with new comp if it is contained
immediately within this exponentiation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">replaceD</span>: <span class="hljs-function"><span class="hljs-params">(old_comp, new_comp)</span>-&gt;</span>
    <span class="hljs-property">@baseval</span>.replaceD(old_comp, new_comp)
    <span class="hljs-property">@powerval</span>.replaceD(old_comp, new_comp)

ttm.class_mixer(Exponentiation)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Pi</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ExpressionComponent</span></span>
  <span class="hljs-attribute">initialize</span>: <span class="hljs-function"><span class="hljs-params">(opts={})</span>-&gt;</span>
    <span class="hljs-keyword">super</span>
    <span class="hljs-property">@pi_value</span> = opts.value
  <span class="hljs-attribute">toString</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-string">"PI"</span>
  <span class="hljs-attribute">cloneData</span>: <span class="hljs-function"><span class="hljs-params">(new_vals={})</span>-&gt;</span>
    data = <span class="hljs-attribute">value</span>: <span class="hljs-property">@pi_value</span>
    ttm.defaults(<span class="hljs-keyword">super</span>, data)

  <span class="hljs-attribute">isVariable</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-literal">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>this wouldnt support a pi value of 0, but you wouldhnt do that, woudl you?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">value</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-property">@pi_value</span> || Math.PI

ttm.class_mixer(Pi)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Addition</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ExpressionComponent</span></span>
  <span class="hljs-attribute">toString</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-string">"Add"</span>
ttm.class_mixer(Addition)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Subtraction</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ExpressionComponent</span></span>
  <span class="hljs-attribute">toString</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-string">"Sub"</span>
ttm.class_mixer(Subtraction)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Multiplication</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ExpressionComponent</span></span>
  <span class="hljs-attribute">toString</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-string">"Mult"</span>
  <span class="hljs-attribute">isMultiplication</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-literal">true</span>
ttm.class_mixer(Multiplication)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Division</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ExpressionComponent</span></span>
  <span class="hljs-attribute">toString</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-string">"Div"</span>
ttm.class_mixer(Division)


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Fraction</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ExpressionComponent</span></span>
  <span class="hljs-attribute">initialize</span>: <span class="hljs-function"><span class="hljs-params">(opts={})</span>-&gt;</span>
    <span class="hljs-keyword">super</span>
    <span class="hljs-property">@numerator_value</span> = <span class="hljs-keyword">if</span> opts.numerator
      opts.numerator.withParent(@)
    <span class="hljs-keyword">else</span>
      <span class="hljs-property">@component_source</span>.build_expression(<span class="hljs-attribute">parent</span>: @)

    <span class="hljs-property">@denominator_value</span> = <span class="hljs-keyword">if</span> opts.denominator
      opts.denominator.withParent(@)
    <span class="hljs-keyword">else</span>
      <span class="hljs-property">@component_source</span>.build_expression(<span class="hljs-attribute">parent</span>: @)

  <span class="hljs-attribute">toString</span>:<span class="hljs-function"> -&gt;</span>
    <span class="hljs-string">"Frac(num: <span class="hljs-subst">#{<span class="hljs-property">@numerator</span>().toString()}</span>, den: <span class="hljs-subst">#{<span class="hljs-property">@denominator</span>().toString()}</span>)"</span>

  <span class="hljs-attribute">numerator</span>:<span class="hljs-function"> -&gt;</span>
    <span class="hljs-property">@numerator_value</span>

  <span class="hljs-attribute">denominator</span>:<span class="hljs-function"> -&gt;</span>
    <span class="hljs-property">@denominator_value</span>

  <span class="hljs-attribute">subExpressions</span>:<span class="hljs-function"> -&gt;</span>
    [<span class="hljs-property">@numerator</span>(), <span class="hljs-property">@denominator</span>()]

  <span class="hljs-attribute">isFraction</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-literal">true</span>

  <span class="hljs-attribute">clone</span>: <span class="hljs-function"><span class="hljs-params">(new_vals={})</span>-&gt;</span>
    data =
      <span class="hljs-attribute">numerator</span>: <span class="hljs-property">@numerator</span>().clone()
      <span class="hljs-attribute">denominator</span>: <span class="hljs-property">@denominator</span>().clone()
    base_data = <span class="hljs-property">@cloneData</span>()
    other = <span class="hljs-property">@klass</span>.build(_.extend({}, base_data, data, new_vals))
    other


ttm.class_mixer(Fraction)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Blank</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ExpressionComponent</span></span>
  <span class="hljs-attribute">toString</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-string">"Blnk"</span>
ttm.class_mixer(Blank)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Root</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ExpressionComponent</span></span>
  <span class="hljs-attribute">initialize</span>: <span class="hljs-function"><span class="hljs-params">(opts={})</span>-&gt;</span>
    <span class="hljs-keyword">super</span>
    <span class="hljs-property">@degree_value</span> = opts.degree
    <span class="hljs-property">@radicand_value</span> = opts.radicand

  <span class="hljs-attribute">toString</span>:<span class="hljs-function"> -&gt;</span>
    <span class="hljs-string">"Root(deg: <span class="hljs-subst">#{<span class="hljs-property">@degree</span>().toString()}</span>, rad: <span class="hljs-subst">#{<span class="hljs-property">@radicand</span>().toString()}</span>)"</span>

  <span class="hljs-attribute">degree</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-property">@degree_value</span>

  <span class="hljs-attribute">radicand</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-property">@radicand_value</span>

  <span class="hljs-attribute">updateRadicand</span>: <span class="hljs-function"><span class="hljs-params">(new_radic)</span>-&gt;</span>
    <span class="hljs-property">@clone</span>(<span class="hljs-attribute">radicand</span>: new_radic)

  <span class="hljs-attribute">isRoot</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-literal">true</span>

  <span class="hljs-attribute">cloneData</span>: <span class="hljs-function"><span class="hljs-params">(new_vals={})</span>-&gt;</span>

    data =
      <span class="hljs-attribute">degree</span>: <span class="hljs-property">@degree_value</span> &amp;&amp; <span class="hljs-property">@degree_value</span>.clone()
      <span class="hljs-attribute">radicand</span>: <span class="hljs-property">@radicand_value</span> &amp;&amp; <span class="hljs-property">@radicand_value</span>.clone()

    ttm.defaults(<span class="hljs-keyword">super</span>, data)

  <span class="hljs-attribute">subExpressions</span>:<span class="hljs-function"> -&gt;</span>
    [<span class="hljs-property">@degree</span>(), <span class="hljs-property">@radicand</span>()]</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>replace old comp with new comp if it is contained
immediately within this root</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-attribute">replaceD</span>: <span class="hljs-function"><span class="hljs-params">(old_comp, new_comp)</span>-&gt;</span>
    <span class="hljs-property">@degree_value</span>.replaceD(old_comp, new_comp)
    <span class="hljs-property">@radicand_value</span>.replaceD(old_comp, new_comp)


ttm.class_mixer(Root)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Variable</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ExpressionComponent</span></span>
  <span class="hljs-attribute">initialize</span>: <span class="hljs-function"><span class="hljs-params">(opts={})</span>-&gt;</span>
    <span class="hljs-keyword">super</span>
    <span class="hljs-property">@name_value</span> = opts.name
  <span class="hljs-attribute">name</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-property">@name_value</span>
  <span class="hljs-attribute">clone</span>: <span class="hljs-function"><span class="hljs-params">(new_vals={})</span>-&gt;</span>
    data =
      <span class="hljs-attribute">name</span>: <span class="hljs-property">@name_value</span>
    base_data = <span class="hljs-property">@cloneData</span>()
    <span class="hljs-property">@klass</span>.build(_.extend({}, base_data, data, new_vals))

  <span class="hljs-attribute">toString</span>:<span class="hljs-function"> -&gt;</span>
    <span class="hljs-string">"Var(<span class="hljs-subst">#{<span class="hljs-property">@name</span>()}</span>)"</span>
  <span class="hljs-attribute">isVariable</span>:<span class="hljs-function"> -&gt;</span> <span class="hljs-literal">true</span>
ttm.class_mixer(Variable)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Fn</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ExpressionComponent</span></span>
  <span class="hljs-attribute">initialize</span>: <span class="hljs-function"><span class="hljs-params">(opts={})</span>-&gt;</span>
    <span class="hljs-keyword">super</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>we only support single-argument functions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-property">@name_value</span> = opts.name
    <span class="hljs-property">@argument_value</span> = opts.argument

  <span class="hljs-attribute">cloneData</span>: <span class="hljs-function"><span class="hljs-params">(new_vals={})</span>-&gt;</span>
    ttm.defaults(<span class="hljs-keyword">super</span>, {
      <span class="hljs-attribute">name</span>: <span class="hljs-property">@name_value</span>
      <span class="hljs-attribute">argument</span>: <span class="hljs-property">@argument</span>() &amp;&amp; <span class="hljs-property">@argument</span>().clone()
    })

  <span class="hljs-attribute">subExpressions</span>:<span class="hljs-function"> -&gt;</span>
    [<span class="hljs-property">@argument</span>()]

  <span class="hljs-attribute">toString</span>:<span class="hljs-function"> -&gt;</span>
    <span class="hljs-string">"Fn(name: <span class="hljs-subst">#{<span class="hljs-property">@name</span>()}</span>, argument: <span class="hljs-subst">#{<span class="hljs-property">@argument</span>().toString()}</span>)"</span>

  <span class="hljs-attribute">argument</span>:<span class="hljs-function"> -&gt;</span>
    <span class="hljs-property">@argument_value</span>

  <span class="hljs-attribute">name</span>:<span class="hljs-function"> -&gt;</span>
    <span class="hljs-property">@name_value</span>

ttm.class_mixer(Fn)

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExpressionIDSource</span></span>
  <span class="hljs-attribute">initialize</span>:<span class="hljs-function"> -&gt;</span>
    <span class="hljs-property">@id</span> = <span class="hljs-number">0</span>
  <span class="hljs-attribute">next</span>:<span class="hljs-function"> -&gt;</span>
    next = ++<span class="hljs-property">@id</span>
    next
  <span class="hljs-attribute">current</span>:<span class="hljs-function"> -&gt;</span>
    <span class="hljs-property">@id</span>

ttm.class_mixer(ExpressionIDSource)

components =
  <span class="hljs-attribute">expression</span>: Expression
  <span class="hljs-attribute">addition</span>: Addition
  <span class="hljs-attribute">number</span>: Number
  <span class="hljs-attribute">multiplication</span>: Multiplication
  <span class="hljs-attribute">division</span>: Division
  <span class="hljs-attribute">subtraction</span>: Subtraction
  <span class="hljs-attribute">exponentiation</span>: Exponentiation
  <span class="hljs-attribute">pi</span>: Pi
  <span class="hljs-attribute">equals</span>: Equals
  <span class="hljs-attribute">blank</span>: Blank
  <span class="hljs-attribute">root</span>: Root
  <span class="hljs-attribute">variable</span>: Variable
  <span class="hljs-attribute">fraction</span>: Fraction
  <span class="hljs-attribute">fn</span>: Fn

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExpressionComponentSource</span></span>
  <span class="hljs-attribute">initialize</span>: <span class="hljs-function"><span class="hljs-params">(precise_lib)</span>-&gt;</span>
    <span class="hljs-property">@id_source</span> = ExpressionIDSource.build()
    <span class="hljs-property">@precise_lib</span> = precise_lib
  <span class="hljs-class">classes: <span class="hljs-title">components</span></span>

<span class="hljs-keyword">for</span> name, klass <span class="hljs-keyword">of</span> components
  <span class="hljs-keyword">continue</span> <span class="hljs-keyword">if</span> name == <span class="hljs-string">"number"</span>
  build_klass = <span class="hljs-keyword">do</span> <span class="hljs-function"><span class="hljs-params">(name, klass)</span>-&gt;</span>
    <span class="hljs-function"><span class="hljs-params">(opts={})</span>-&gt;</span>
      opts.id ||= <span class="hljs-property">@id_source</span>.next()
      opts.component_source = @
      klass.build(opts)

  ExpressionComponentSource.prototype[<span class="hljs-string">"build_<span class="hljs-subst">#{name}</span>"</span>] = build_klass

ExpressionComponentSource.prototype.<span class="hljs-function"><span class="hljs-title">build_number</span> = <span class="hljs-params">(opts={})</span>-&gt;</span>
  opts.id ||= <span class="hljs-property">@id_source</span>.next()
  opts.precise_lib ||= <span class="hljs-property">@precise_lib</span>
  Number.build(opts)


ttm.lib.math.ExpressionComponentSource =
  ttm.class_mixer(ExpressionComponentSource)</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
